<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f4f6f9;
            padding: 20px 0;
            font-family: "Microsoft JhengHei", sans-serif;
        }

        .container {
            max-width: 900px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        /* èª²ç¨‹å¡ç‰‡æ¨£å¼ - ç¶²é ç‰ˆ */
        .course-card {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            background-color: #fafbfc;
            transition: all 0.2s;
        }

        .course-card:hover {
            border-color: #b6d4fe;
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.12);
        }

        .course-info {
            flex: 1;
            padding-right: 20px;
        }

        /* èª²ç¨‹æ¨™é¡Œ */
        .course-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: #1a5fb4;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        /* æ—¥æœŸæ™‚é–“å€ */
        .course-datetime {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #555;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .course-datetime span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* èª²ç¨‹è©³ç´°è³‡è¨Š */
        .course-details {
            font-size: 0.88rem;
            color: #666;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .course-details .detail-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .course-details .detail-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .course-details .label {
            color: #888;
        }

        .course-details .value {
            color: #333;
            font-weight: 500;
        }

        /* èª²ç¨‹é¡åˆ¥ */
        .course-category {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 12px;
        }

        .course-category .label {
            color: #888;
        }

        .course-category .value {
            color: #0d6efd;
        }

        /* æ¨™ç±¤å€ */
        .course-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .course-tag {
            display: inline-block;
            padding: 4px 12px;
            font-size: 0.78rem;
            border-radius: 20px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #555;
            white-space: nowrap;
        }

        .course-tag.tag-nursing {
            border-color: #0d6efd;
            color: #0d6efd;
            background-color: #e7f1ff;
        }

        .course-tag.tag-quality {
            border-color: #198754;
            color: #198754;
            background-color: #d1e7dd;
        }

        .course-tag.tag-subtitle {
            border-color: #6f42c1;
            color: #6f42c1;
            background-color: #e2d9f3;
        }

        .course-tag.tag-broadcast {
            border-color: #fd7e14;
            color: #fd7e14;
            background-color: #fff3cd;
        }

        /* ç¯©é¸å€åŸŸ */
        .filter-section {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 20px;
        }

        .filter-section h6 {
            color: #666;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 25px;
            border: 2px solid #dee2e6;
            background-color: #fff;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: #adb5bd;
            background-color: #f8f9fa;
        }

        .filter-btn.active {
            border-color: #0d6efd;
            background-color: #e7f1ff;
            color: #0d6efd;
        }

        .filter-btn.filter-broadcast.active {
            border-color: #fd7e14;
            background-color: #fff3cd;
            color: #fd7e14;
        }

        .filter-btn.filter-nursing.active {
            border-color: #0d6efd;
            background-color: #e7f1ff;
            color: #0d6efd;
        }

        .filter-btn.filter-quality.active {
            border-color: #198754;
            background-color: #d1e7dd;
            color: #198754;
        }

        .filter-btn.filter-subtitle.active {
            border-color: #6f42c1;
            background-color: #e2d9f3;
            color: #6f42c1;
        }

        .filter-count {
            display: inline-block;
            min-width: 24px;
            padding: 2px 6px;
            font-size: 0.75rem;
            font-weight: bold;
            border-radius: 12px;
            background-color: #e9ecef;
            color: #666;
        }

        .filter-btn.active .filter-count {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .course-card.hidden-by-filter {
            display: none !important;
        }

        /* é è³¼äººæ•¸è¼¸å…¥å€ */
        .input-section {
            min-width: 100px;
            text-align: center;
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
            flex-shrink: 0;
        }

        .input-section label {
            font-size: 0.85rem;
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-weight: 500;
        }

        .input-section input {
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼ */
        @media (max-width: 576px) {
            body {
                overflow-x: hidden;
            }

            .container {
                padding: 10px;
                margin: 0;
                max-width: 100%;
                width: 100%;
            }

            .course-card {
                flex-direction: column;
                padding: 12px;
            }

            .course-info {
                padding-right: 0;
                width: 100%;
            }

            .course-title {
                font-size: 1rem;
                word-wrap: break-word;
            }

            .course-datetime {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .course-details .detail-row {
                flex-direction: column;
                gap: 5px;
            }

            .input-section {
                width: 100%;
                margin-top: 15px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px 15px;
            }

            .input-section label {
                margin-bottom: 0;
                margin-right: 15px;
            }

            .input-section input {
                width: 80px;
            }

            /* ç¯©é¸å€åŸŸæ‰‹æ©Ÿç‰ˆ */
            .filter-section {
                padding: 12px;
                margin-bottom: 15px;
            }

            .filter-section h6 {
                font-size: 0.9rem;
                margin-bottom: 10px;
            }

            .filter-tags {
                gap: 8px;
            }

            .filter-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
                flex: 1 1 calc(50% - 8px);
                justify-content: center;
                min-width: 0;
            }

            .filter-count {
                min-width: 20px;
                padding: 2px 5px;
                font-size: 0.7rem;
            }

            /* æ¨™ç±¤æ‰‹æ©Ÿç‰ˆ */
            .course-tags {
                flex-wrap: wrap;
            }

            .course-tag {
                font-size: 0.7rem;
                padding: 2px 8px;
            }

            /* èª²ç¨‹é¡åˆ¥æ‰‹æ©Ÿç‰ˆ */
            .course-category .value {
                word-wrap: break-word;
                display: block;
            }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>

    <div id="loader" class="loading-overlay">
        <div class="spinner-border text-primary" role="status"></div>
        <div class="mt-3 fw-bold text-secondary">æ­£åœ¨è®€å–æœ€æ–°èª²ç¨‹è³‡è¨Š...</div>
    </div>

    <div class="container" id="form-container">
        <div class="text-center mb-4">
            <img src="https://www.gogocare.com.tw/UserFiles/uploads/images/20251223161024_GOGOCARE_BAN.png"
                alt="GOGOCARE" class="img-fluid" style="max-width: 100%; border-radius: 10px;">
        </div>
        <h2 class="text-center mb-4 fw-bold">èª²ç¨‹é è³¼éœ€æ±‚èª¿æŸ¥è¡¨</h2>
        <p class="alert text-center mb-4" style="background-color: #dcdddd; border-color: #ccc; color: #333;">
            è«‹åœ¨æ‚¨æœ‰èˆˆè¶£çš„èª²ç¨‹å¾Œæ–¹å¡«å¯«æ¬²å ±å/è³¼è²·äººæ•¸ã€‚<br>
            <small>â€» ç©åˆ†å±¬æ€§ã€é¡åˆ¥è©³ç´°ä»¥å¯©æŸ¥å–®ä½é€šéç‚ºä¸»<br>â€» å¯¦éš›é–‹èª²ä»¥ç•¶æœˆå…¬å‘Šç‚ºæº–ã€‚</small>
        </p>

        <form id="courseForm" onsubmit="handleFormSubmit(this)">
            <!-- ç¯©é¸å€åŸŸ -->
            <div class="filter-section">
                <h6>ğŸ” ä¾æ¨™ç±¤ç¯©é¸èª²ç¨‹</h6>
                <div class="filter-tags">
                    <button type="button" class="filter-btn filter-broadcast" data-tag="è½‰æ’­èª²ç¨‹"
                        onclick="toggleFilter(this)">
                        ğŸ“º è½‰æ’­èª²ç¨‹ <span class="filter-count" id="count-broadcast">0</span>
                    </button>
                    <button type="button" class="filter-btn filter-nursing" data-tag="åŒæ­¥è­·ç†ç©åˆ†"
                        onclick="toggleFilter(this)">
                        ğŸ¥ åŒæ­¥è­·ç†ç©åˆ† <span class="filter-count" id="count-nursing">0</span>
                    </button>
                    <button type="button" class="filter-btn filter-quality" data-tag="ä½å®¿æ©Ÿæ§‹å“è³ªçå‹µ"
                        onclick="toggleFilter(this)">
                        ğŸ† ä½å®¿æ©Ÿæ§‹å“è³ªçå‹µ <span class="filter-count" id="count-quality">0</span>
                    </button>
                    <button type="button" class="filter-btn filter-subtitle" data-tag="å¤šèªå­—å¹•"
                        onclick="toggleFilter(this)">
                        ğŸŒ å¤šèªå­—å¹• <span class="filter-count" id="count-subtitle">0</span>
                    </button>
                </div>
            </div>

            <div id="course-list">
                <!-- JS ç”Ÿæˆå…§å®¹ -->
            </div>

            <div class="p-4 bg-light rounded-3 mt-5">
                <h5 class="mb-3 fw-bold">å¡«å¯«è¯çµ¡è³‡è¨Š</h5>
                <div class="mb-3">
                    <label for="companyName" class="form-label">1. å…¬å¸/å–®ä½åç¨± <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="companyName" name="companyName" required
                        placeholder="è«‹è¼¸å…¥å…¬å¸æˆ–å–®ä½åç¨±">
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">2. æ‚¨çš„é›»å­ä¿¡ç®± <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="email" name="email" required
                        placeholder="name@example.com">
                    <div class="form-text">ç³»çµ±å°‡æœƒè‡ªå‹•ç™¼é€ç¢ºèªä¿¡è‡³æ­¤ä¿¡ç®±ã€‚</div>
                </div>

                <div class="mb-3">
                    <label for="otherNeeds" class="form-label">3. æœ‰æ²’æœ‰å…¶ä»–èª²ç¨‹éœ€æ±‚? æˆ‘å€‘å¯ä»¥å”åŠ©åª’åˆé–‹èª²å–”ã€‚(å¡«ä¸Šé è¨ˆä¸Šèª²äººæ•¸)</label>
                    <textarea class="form-control" id="otherNeeds" name="otherNeeds" rows="3"
                        placeholder="è«‹å¡«å¯«æ‚¨çš„éœ€æ±‚..."></textarea>
                </div>
            </div>

            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">é€å‡ºé è³¼éœ€æ±‚</button>
            </div>
        </form>
    </div>

    <!-- æˆåŠŸç•«é¢ -->
    <div class="container hidden" id="success-container">
        <div class="text-center py-5">
            <div style="font-size: 4rem; color: #198754;">âœ”</div>
            <h3 class="mt-3">éœ€æ±‚å–®å·²é€å‡ºï¼</h3>
            <div id="email-info">
                <p class="text-muted">ç¢ºèªä¿¡å·²å¯„é€è‡³ï¼š<span id="success-email" class="fw-bold text-dark"></span></p>
                <p class="text-muted">æƒ³çœ‹æ›´å¤šèª²ç¨‹è³‡è¨Šï¼Œè«‹è¦‹ <a
                        href="https://docs.google.com/spreadsheets/d/1CRQMLPQp5fBARvG1U7o9aOru-YTkXGfiQBxrDFZB_Z4/edit?gid=1524737083#gid=1524737083&range=A1:F1"
                        target="_blank" class="fw-bold">2026_èª²ç¨‹ç¸½è¡¨</a></p>
            </div>

            <div class="card mt-4 text-start shadow-sm">
                <div class="card-header bg-success text-white">æ‚¨çš„é è³¼æ¸…å–®</div>
                <div class="card-body p-0">
                    <div id="success-list"></div>
                </div>
            </div>

            <div class="mt-4">
                <button class="btn btn-outline-secondary" onclick="resetForm()">å¡«å¯«æ–°è¡¨å–®</button>
            </div>
        </div>
    </div>

    <!-- è«‹æ›¿æ› Index.html æœ€ä¸‹æ–¹çš„ <script>å€å¡Š -->
    <script>
        // ========== è¨­å®šå€åŸŸ ==========
        // è«‹å°‡æ­¤ URL æ›¿æ›ç‚ºæ‚¨éƒ¨ç½²çš„ GAS Web App URL
        const API_URL = 'https://script.google.com/macros/s/AKfycbzY8epjSzWX-_KXHnZ2pfbRmrlM1MhYx2aGb82aL3-86aZDaMin5Vl1ZsMHwAykcVQnPg/exec';

        // é é¢è¼‰å…¥æ™‚å–å¾—è³‡æ–™
        window.onload = function () {
            console.log("æ­¥é©Ÿ 1: ç¶²é è¼‰å…¥å®Œæˆï¼Œæº–å‚™å‘¼å«å¾Œç«¯...");

            // ä½¿ç”¨ fetch å‘¼å« GAS API
            fetch(API_URL + '?action=getCourseData')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ç¶²è·¯å›æ‡‰éŒ¯èª¤: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("æ­¥é©Ÿ 2: æˆåŠŸæ”¶åˆ°å¾Œç«¯è³‡æ–™ï¼", data);
                    renderCourses(data);
                })
                .catch(error => {
                    console.error("æ­¥é©Ÿ 2: å‘¼å«å¤±æ•—ï¼éŒ¯èª¤åŸå› ï¼š", error);
                    alert("è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª API ç¶²å€æ˜¯å¦æ­£ç¢ºï¼š\n" + error);
                    document.getElementById('loader').innerText = "è®€å–ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ API è¨­å®šæˆ–ç¶²è·¯ã€‚";
                });
        };

        function renderCourses(courses) {
            console.log("æ­¥é©Ÿ 3: é–‹å§‹ç¹ªè£½ç•«é¢ï¼Œè³‡æ–™ç­†æ•¸ï¼š" + courses.length);
            const listDiv = document.getElementById('course-list');

            if (courses.length === 0) {
                listDiv.innerHTML = '<div class="alert alert-warning">ç›®å‰æ²’æœ‰èª²ç¨‹è³‡æ–™ï¼Œæˆ–ç„¡æ³•è®€å–è©¦ç®—è¡¨ã€‚</div>';
                document.getElementById('loader').classList.add('hidden');
                return;
            }

            let html = '';
            courses.forEach(course => {
                // ç”¢ç”Ÿæ¨™ç±¤ HTML
                let tagsHtml = '';
                let tagsData = course.tags ? course.tags.join(',') : '';
                if (course.tags && course.tags.length > 0) {
                    course.tags.forEach(tag => {
                        let tagClass = 'course-tag';
                        if (tag === 'åŒæ­¥è­·ç†ç©åˆ†') tagClass += ' tag-nursing';
                        else if (tag === 'ä½å®¿æ©Ÿæ§‹å“è³ªçå‹µ') tagClass += ' tag-quality';
                        else if (tag === 'å¤šèªå­—å¹•') tagClass += ' tag-subtitle';
                        else if (tag === 'è½‰æ’­èª²ç¨‹') tagClass += ' tag-broadcast';
                        tagsHtml += `<span class="${tagClass}">${tag}</span>`;
                    });
                }

                html += `
          <div class="course-card" data-tags="${tagsData}">
            <div class="course-info">
              <!-- èª²ç¨‹æ¨™é¡Œ -->
              <div class="course-title">${course.displayNameHtml || course.rawNames || 'èª²ç¨‹åç¨±å¾…å®š'}</div>
              
              <!-- æ—¥æœŸæ™‚é–“ -->
              <div class="course-datetime">
                <span>ğŸ“… ${course.date || 'æ—¥æœŸå¾…å®š'}${course.date ? '' : ''}</span>
                <span>ğŸ•’ ${course.time || 'æ™‚é–“å¾…å®š'}</span>
              </div>
              
              <!-- èª²ç¨‹è©³ç´°è³‡è¨Š -->
              <div class="course-details">
                <div class="detail-row">
                  <div class="detail-item">
                    <span class="label">ä¸Šèª²æ–¹å¼ï¼š</span>
                    <span class="value">${course.teachingMethod || '-'}</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">æ™‚æ•¸ï¼š</span>
                    <span class="value">${course.hours ? course.hours + ' å°æ™‚' : '-'}</span>
                  </div>
                  <div class="detail-item">
                    <span class="label">é è¨ˆç©åˆ†æ•¸ï¼š</span>
                    <span class="value">${course.credits || '-'}</span>
                  </div>
                </div>
              </div>
              
              <!-- èª²ç¨‹é¡åˆ¥ -->
              ${course.category ? `
              <div class="course-category">
                <span class="label">èª²ç¨‹é¡åˆ¥ï¼š</span>
                <span class="value">${course.category}</span>
              </div>
              ` : ''}
              
              <!-- æ¨™ç±¤ -->
              ${tagsHtml ? `<div class="course-tags">${tagsHtml}</div>` : ''}
            </div>
            
            <!-- é è³¼äººæ•¸è¼¸å…¥ -->
            <div class="input-section">
              <label>é è³¼äººæ•¸</label>
              <input type="number" class="form-control text-center" name="qty_${course.id}" min="0" placeholder="0">
            </div>
          </div>
        `;
            });

            listDiv.innerHTML = html;
            // éš±è—è®€å–å‹•ç•«
            document.getElementById('loader').classList.add('hidden');
            // æ›´æ–°æ¨™ç±¤è¨ˆæ•¸
            updateTagCounts();
            console.log("æ­¥é©Ÿ 4: ç•«é¢ç¹ªè£½å®Œæˆ");
        }

        // è™•ç†è¡¨å–®æäº¤
        function handleFormSubmit(formElement) {
            event.preventDefault();

            // æ”¶é›†èª²ç¨‹è³‡æ–™
            const courses = [];
            formElement.querySelectorAll('input[type="number"]').forEach(input => {
                const qty = parseInt(input.value);
                if (qty > 0) {
                    const courseId = input.name.replace('qty_', '');
                    courses.push({ id: courseId, qty: qty });
                }
            });

            if (courses.length === 0) {
                alert("è«‹è‡³å°‘åœ¨ä¸€å€‹èª²ç¨‹æ¬„ä½å¡«å¯«äººæ•¸ï¼");
                return;
            }

            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerText = "è™•ç†ä¸­...";

            const loader = document.getElementById('loader');
            loader.classList.remove('hidden');
            loader.querySelector('div.mt-3').innerText = "æ­£åœ¨å„²å­˜è¨‚å–®...";

            // çµ„è£ JSON è³‡æ–™
            const formData = {
                email: formElement.email.value,
                companyName: formElement.companyName.value,
                otherNeeds: formElement.otherNeeds.value,
                courses: courses
            };

            // ä½¿ç”¨ fetch POST é€å‡ºè³‡æ–™
            fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8'
                },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ç¶²è·¯å›æ‡‰éŒ¯èª¤: ' + response.status);
                    }
                    return response.json();
                })
                .then(response => onSuccess(response))
                .catch(error => onFailure(error));
        }

        function onSuccess(response) {
            document.getElementById('loader').classList.add('hidden');
            if (response.status === 'success') {
                document.getElementById('form-container').classList.add('hidden');
                document.getElementById('success-container').classList.remove('hidden');

                // æ ¹æ“šéƒµä»¶ç™¼é€ç‹€æ…‹é¡¯ç¤ºä¸åŒè¨Šæ¯
                const emailInfoEl = document.getElementById('email-info');
                const courseListLink = '<p class="text-muted">æƒ³çœ‹æ›´å¤šèª²ç¨‹è³‡è¨Šï¼Œè«‹è¦‹ <a href="https://docs.google.com/spreadsheets/d/1CRQMLPQp5fBARvG1U7o9aOru-YTkXGfiQBxrDFZB_Z4/edit?gid=1524737083#gid=1524737083&range=A1:F1" target="_blank" class="fw-bold">2026_èª²ç¨‹ç¸½è¡¨</a></p>';
                if (response.emailSent) {
                    emailInfoEl.innerHTML = '<p class="text-muted">ç¢ºèªä¿¡å·²å¯„é€è‡³ï¼š<span id="success-email" class="fw-bold text-dark">' + response.email + '</span></p>' + courseListLink;
                } else {
                    emailInfoEl.innerHTML = '<p class="text-warning">âš ï¸ éƒµä»¶ç™¼é€å¤±æ•—ï¼Œä½†æ‚¨çš„é è³¼éœ€æ±‚å·²æˆåŠŸå„²å­˜ã€‚<br><small class="text-muted">æ‚¨çš„ä¿¡ç®±ï¼š' + response.email + '</small></p>' + courseListLink;
                    console.error('éƒµä»¶ç™¼é€éŒ¯èª¤:', response.emailError);
                }

                let listHtml = '';
                response.data.forEach(item => {
                    // ç”¢ç”Ÿæ¨™ç±¤ HTML
                    let tagsHtml = '';
                    if (item.tags && item.tags.length > 0) {
                        item.tags.forEach(tag => {
                            let tagClass = 'course-tag';
                            if (tag === 'åŒæ­¥è­·ç†ç©åˆ†') tagClass += ' tag-nursing';
                            else if (tag === 'ä½å®¿æ©Ÿæ§‹å“è³ªçå‹µ') tagClass += ' tag-quality';
                            else if (tag === 'å¤šèªå­—å¹•') tagClass += ' tag-subtitle';
                            else if (tag === 'è½‰æ’­èª²ç¨‹') tagClass += ' tag-broadcast';
                            tagsHtml += `<span class="${tagClass}">${tag}</span>`;
                        });
                    }

                    listHtml += `
            <div class="course-card">
              <div class="course-info">
                <!-- èª²ç¨‹æ¨™é¡Œ -->
                <div class="course-title">${item.name || 'èª²ç¨‹åç¨±'}</div>
                
                <!-- æ—¥æœŸæ™‚é–“ -->
                <div class="course-datetime">
                  <span>ğŸ“… ${item.date || 'æ—¥æœŸå¾…å®š'}</span>
                  <span>ğŸ•’ ${item.time || 'æ™‚é–“å¾…å®š'}</span>
                </div>
                
                <!-- èª²ç¨‹è©³ç´°è³‡è¨Š -->
                <div class="course-details">
                  <div class="detail-row">
                    <div class="detail-item">
                      <span class="label">ä¸Šèª²æ–¹å¼ï¼š</span>
                      <span class="value">${item.teachingMethod || '-'}</span>
                    </div>
                    <div class="detail-item">
                      <span class="label">æ™‚æ•¸ï¼š</span>
                      <span class="value">${item.hours ? item.hours + ' å°æ™‚' : '-'}</span>
                    </div>
                    <div class="detail-item">
                      <span class="label">é è¨ˆç©åˆ†æ•¸ï¼š</span>
                      <span class="value">${item.credits || '-'}</span>
                    </div>
                  </div>
                </div>
                
                <!-- èª²ç¨‹é¡åˆ¥ -->
                ${item.category ? `
                <div class="course-category">
                  <span class="label">èª²ç¨‹é¡åˆ¥ï¼š</span>
                  <span class="value">${item.category}</span>
                </div>
                ` : ''}
                
                <!-- æ¨™ç±¤ -->
                ${tagsHtml ? `<div class="course-tags">${tagsHtml}</div>` : ''}
              </div>
              
              <!-- é è³¼äººæ•¸ -->
              <div class="input-section" style="background: #198754; border-color: #198754;">
                <label style="color: white;">é è³¼äººæ•¸</label>
                <div style="font-size: 1.5rem; font-weight: bold; color: white;">${item.qty} äºº</div>
              </div>
            </div>
          `;
                });
                document.getElementById('success-list').innerHTML = listHtml;

                // æ²å‹•åˆ°é é¢é ‚éƒ¨
                window.scrollTo(0, 0);
            } else {
                alert("éŒ¯èª¤ï¼š" + response.message);
                resetBtn();
            }
        }

        function onFailure(e) {
            document.getElementById('loader').classList.add('hidden');
            alert("ç³»çµ±éŒ¯èª¤ï¼š" + e);
            resetBtn();
        }

        function resetBtn() {
            const btn = document.getElementById('submitBtn');
            btn.disabled = false;
            btn.innerText = "é€å‡ºéœ€æ±‚";
        }

        // é‡ç½®è¡¨å–®ï¼ˆå¡«å¯«æ–°è¡¨å–®ï¼‰
        function resetForm() {
            // é¡¯ç¤ºè¡¨å–®å®¹å™¨ï¼Œéš±è—æˆåŠŸé é¢
            document.getElementById('form-container').classList.remove('hidden');
            document.getElementById('success-container').classList.add('hidden');

            // é‡ç½®è¡¨å–®æ¬„ä½
            document.getElementById('courseForm').reset();

            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            resetBtn();

            // æ¸…ç©ºæˆåŠŸé é¢çš„è³‡æ–™
            document.getElementById('email-info').innerHTML = '<p class="text-muted">ç¢ºèªä¿¡å·²å¯„é€è‡³ï¼š<span id="success-email" class="fw-bold text-dark"></span></p>';
            document.getElementById('success-list').innerHTML = '';

            // æ²å‹•åˆ°é é¢é ‚éƒ¨
            window.scrollTo(0, 0);
        }

        // ========== æ¨™ç±¤ç¯©é¸åŠŸèƒ½ ==========
        let activeFilters = [];

        // åˆ‡æ›ç¯©é¸æŒ‰éˆ•ç‹€æ…‹
        function toggleFilter(btn) {
            const tag = btn.getAttribute('data-tag');
            btn.classList.toggle('active');

            if (btn.classList.contains('active')) {
                if (!activeFilters.includes(tag)) {
                    activeFilters.push(tag);
                }
            } else {
                activeFilters = activeFilters.filter(t => t !== tag);
            }

            applyFilters();
        }

        // æ‡‰ç”¨ç¯©é¸æ¢ä»¶
        function applyFilters() {
            const cards = document.querySelectorAll('.course-card');

            cards.forEach(card => {
                const cardTags = card.getAttribute('data-tags') || '';

                if (activeFilters.length === 0) {
                    // æ²’æœ‰ç¯©é¸æ¢ä»¶ï¼Œé¡¯ç¤ºå…¨éƒ¨
                    card.classList.remove('hidden-by-filter');
                } else {
                    // æª¢æŸ¥å¡ç‰‡æ˜¯å¦åŒ…å«æ‰€æœ‰é¸ä¸­çš„æ¨™ç±¤
                    const hasAllTags = activeFilters.every(filter => cardTags.includes(filter));
                    if (hasAllTags) {
                        card.classList.remove('hidden-by-filter');
                    } else {
                        card.classList.add('hidden-by-filter');
                    }
                }
            });

            // é¡¯ç¤ºç¯©é¸çµæœæ•¸é‡
            const visibleCount = document.querySelectorAll('.course-card:not(.hidden-by-filter)').length;
            console.log(`ç¯©é¸çµæœï¼š${visibleCount} å€‹èª²ç¨‹`);
        }

        // æ›´æ–°å„æ¨™ç±¤çš„èª²ç¨‹æ•¸é‡
        function updateTagCounts() {
            const cards = document.querySelectorAll('.course-card');
            let counts = {
                'è½‰æ’­èª²ç¨‹': 0,
                'åŒæ­¥è­·ç†ç©åˆ†': 0,
                'ä½å®¿æ©Ÿæ§‹å“è³ªçå‹µ': 0,
                'å¤šèªå­—å¹•': 0
            };

            cards.forEach(card => {
                const tags = card.getAttribute('data-tags') || '';
                if (tags.includes('è½‰æ’­èª²ç¨‹')) counts['è½‰æ’­èª²ç¨‹']++;
                if (tags.includes('åŒæ­¥è­·ç†ç©åˆ†')) counts['åŒæ­¥è­·ç†ç©åˆ†']++;
                if (tags.includes('ä½å®¿æ©Ÿæ§‹å“è³ªçå‹µ')) counts['ä½å®¿æ©Ÿæ§‹å“è³ªçå‹µ']++;
                if (tags.includes('å¤šèªå­—å¹•')) counts['å¤šèªå­—å¹•']++;
            });

            document.getElementById('count-broadcast').textContent = counts['è½‰æ’­èª²ç¨‹'];
            document.getElementById('count-nursing').textContent = counts['åŒæ­¥è­·ç†ç©åˆ†'];
            document.getElementById('count-quality').textContent = counts['ä½å®¿æ©Ÿæ§‹å“è³ªçå‹µ'];
            document.getElementById('count-subtitle').textContent = counts['å¤šèªå­—å¹•'];
        }
    </script>